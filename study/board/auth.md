### JWT

사용자 정보를 담고 있고, 위조 방지를 위한 디지털 서명

Header.Payload.Signature


##### Header

- alg: 서명에 사용할 알고리즘 (HMAC SHA256, RSA 등)

    - RSA나 ECDSA는 비대칭키를 사용합니다. 개인키로 서명하고 공개키로 검증합니다. 마이크로서비스에서 토큰 발급 서버와 검증 서버가 다를 때 유용합니다.
    - HMAC(HS256, HS384, HS512)은 대칭키를 사용합니다. 같은 키로 서명하고 검증
    - 반드시 알고리즘을 검증해야함 ( Algorithm Confusion Attack) - alg 조작 하여 공격

- typ: 토큰 타입 (항상 "JWT")

##### Payload

```
등록된 클레임	JWT 표준에서 정의한 클레임	iss, sub, exp, iat
공개 클레임	충돌 방지를 위해 URI 형태로 정의	https://example.com/claims/role
비공개 클레임	당사자 간 합의한 클레임	name, admin, role

### 등록된 클레임 ###
    
    클레임	의미	설명
    iss	Issuer	토큰 발급자
    sub	Subject	토큰 주체 (보통 사용자 ID)
    aud	Audience	토큰 대상자
    exp	Expiration	만료 시간 (Unix timestamp)
    iat	Issued At	발급 시간
    nbf	Not Before	활성화 시간
    jti	JWT ID	토큰 고유 식별자
```

##### Signature

서명은 토큰이 위조되지 않았음을 증명
-> 비밀키를 모르면 유효한 서명을 만들 수 없습니다. 따라서 서명이 올바르면 토큰이 위조되지 않았다고 확신

핵심 :: 서버가 상태를 저장하지 않는다는 것입니다. 토큰 자체에 필요한 정보가 모두 들어있으므로, 서버는 토큰만 검증


세션 VS 토큰
```
항목	세션 방식	JWT 방식
저장 위치	서버 메모리/DB	클라이언트
상태 유지	서버가 상태 유지 (Stateful)	상태 없음 (Stateless)
확장성	세션 동기화 필요	확장 용이
보안	서버에서 세션 무효화 가능	토큰 무효화 어려움
용량	세션 ID만 전송 (작음)	전체 정보 전송 (큼)
모바일	쿠키 처리 복잡	헤더로 간단히 전송

JWT 적절 상황 
    REST API를 제공하는 백엔드
    마이크로서비스 아키텍처
    모바일 앱 백엔드
    서버가 여러 대인 환경
    서드파티 서비스 연동


세션이 적절한 경우
    단일 서버 환경
    보안이 매우 중요한 금융 서비스
    실시간 세션 통제가 필요한 경우
```
JWT의 장단점
```
장점
    무상태(Stateless): 서버가 세션을 저장할 필요 없음
    확장성: 서버를 쉽게 늘릴 수 있음
    다양한 클라이언트: 웹, 모바일, IoT 등 어디서나 사용 가능
    마이크로서비스: 서비스 간 인증 정보 전달 용이
    표준화: RFC 7519로 표준화되어 있음
단점
    토큰 크기: 세션 ID보다 크기가 큼
    무효화 어려움: 발급된 토큰을 강제로 만료시키기 어려움
    탈취 위험: 토큰이 탈취되면 만료까지 악용 가능
    갱신 필요: 만료 전 갱신 로직 필요
```



토큰 생성 흐름

```yaml
1. 토큰 문자열 수신
→ "eyJhbGci..."

2. 형식 검증
→ Header.Payload.Signature 형태인지 확인

3. 헤더 파싱
→ 알고리즘 확인 (HS256인지?)

4. 서명 검증
→ 비밀키로 서명 재계산 후 비교

5. 클레임 파싱
→ JSON 디코딩

6. 표준 클레임 검증
→ exp, iat, nbf, iss 등 확인

7. 커스텀 검증
→ Validate() 메서드 호출

8. 검증 완료
→ Claims 반환
```

토큰 갱신 흐름
```
1. 클라이언트가 Access Token으로 API 호출
2. 서버: "토큰 만료됨" 응답 (401)
3. 클라이언트가 Refresh Token으로 갱신 요청
4. 서버: 새 Access Token (+ 새 Refresh Token) 발급
5. 클라이언트가 새 토큰으로 원래 요청 재시도
```